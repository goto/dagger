"use strict";(self.webpackChunkdagger=self.webpackChunkdagger||[]).push([[7356],{3905:(e,t,r)=>{r.d(t,{Zo:()=>c,kt:()=>d});var a=r(7294);function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},o=Object.keys(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var l=a.createContext({}),p=function(e){var t=a.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},c=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var r=e.components,n=e.mdxType,o=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),u=p(r),d=n,g=u["".concat(l,".").concat(d)]||u[d]||m[d]||o;return r?a.createElement(g,i(i({ref:t},c),{},{components:r})):a.createElement(g,i({ref:t},c))}));function d(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=r.length,i=new Array(o);i[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:n,i[1]=s;for(var p=2;p<o;p++)i[p]=r[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,r)}u.displayName="MDXCreateElement"},2157:(e,t,r)=>{r.r(t),r.d(t,{contentTitle:()=>i,default:()=>c,frontMatter:()=>o,metadata:()=>s,toc:()=>l});var a=r(7462),n=(r(7294),r(3905));const o={},i="Dagger Quickstart",s={unversionedId:"guides/quickstart",id:"guides/quickstart",isDocsHomePage:!1,title:"Dagger Quickstart",description:"Prerequisites",source:"@site/docs/guides/quickstart.md",sourceDirName:"guides",slug:"/guides/quickstart",permalink:"/dagger/docs/guides/quickstart",editUrl:"https://github.com/odpf/dagger/edit/master/docs/docs/guides/quickstart.md",tags:[],version:"current",frontMatter:{},sidebar:"docsSidebar",previous:{title:"Overview",permalink:"/dagger/docs/guides/overview"},next:{title:"Choosing a Source",permalink:"/dagger/docs/guides/choose_source"}},l=[{value:"Prerequisites",id:"prerequisites",children:[]},{value:"Quickstart",id:"quickstart",children:[]},{value:"Troubleshooting",id:"troubleshooting",children:[]}],p={toc:l};function c(e){let{components:t,...r}=e;return(0,n.kt)("wrapper",(0,a.Z)({},p,r,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"dagger-quickstart"},"Dagger Quickstart"),(0,n.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("strong",{parentName:"li"},"Your Java version is Java 8"),": Dagger as of now works only with Java 8. Some features might not work with older or later versions."),(0,n.kt)("li",{parentName:"ol"},"Your ",(0,n.kt)("strong",{parentName:"li"},"Kafka")," version is ",(0,n.kt)("strong",{parentName:"li"},"3.0.0")," or a minor version of it"),(0,n.kt)("li",{parentName:"ol"},"You have ",(0,n.kt)("strong",{parentName:"li"},"kcat")," installed: We will use kcat to push messages to Kafka from the CLI. You can follow the installation steps ",(0,n.kt)("a",{parentName:"li",href:"https://github.com/edenhill/kcat"},"here"),". Ensure the version you install is 1.7.0 or a minor version of it."),(0,n.kt)("li",{parentName:"ol"},"You have ",(0,n.kt)("strong",{parentName:"li"},"protobuf")," installed: We will use protobuf to push messages encoded in protobuf format to Kafka topic. You can follow the installation steps for MacOS ",(0,n.kt)("a",{parentName:"li",href:"https://formulae.brew.sh/formula/protobuf"},"here"),". For other OS, please download the corresponding release from ",(0,n.kt)("a",{parentName:"li",href:"https://github.com/protocolbuffers/protobuf/releases"},"here"),". Please note, this quickstart has been written to work with",(0,n.kt)("a",{parentName:"li",href:"https://github.com/protocolbuffers/protobuf/releases/tag/v3.17.3"}," 3.17.3")," of protobuf. Compatibility with other versions is unknown."),(0,n.kt)("li",{parentName:"ol"},"You have ",(0,n.kt)("strong",{parentName:"li"},"Python 2.7+")," and ",(0,n.kt)("strong",{parentName:"li"},"simple-http-server")," installed: We will use Python along with simple-http-server to spin up a mock Stencil server which can serve the proto descriptors to Dagger. To install ",(0,n.kt)("strong",{parentName:"li"},"simple-http-server"),", please follow these ",(0,n.kt)("a",{parentName:"li",href:"https://pypi.org/project/simple-http-server/"},"installation steps"),".")),(0,n.kt)("h2",{id:"quickstart"},"Quickstart"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Clone Dagger repository into your local")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"git clone https://github.com/odpf/dagger.git\n")),(0,n.kt)("ol",{start:2},(0,n.kt)("li",{parentName:"ol"},"Next, we will generate our proto descriptor set. Ensure you are at the top level directory(",(0,n.kt)("inlineCode",{parentName:"li"},"dagger"),") and then fire this command")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},"./gradlew clean dagger-common:generateTestProto\n")),(0,n.kt)("p",null,"This command will generate a descriptor set containing the proto descriptors of all the proto files present under ",(0,n.kt)("inlineCode",{parentName:"p"},"dagger-common/src/test/proto"),". After running this, you should see a binary file called ",(0,n.kt)("inlineCode",{parentName:"p"},"dagger-descriptors.bin")," under ",(0,n.kt)("inlineCode",{parentName:"p"},"dagger-common/src/generated-sources/descriptors/"),"."),(0,n.kt)("ol",{start:3},(0,n.kt)("li",{parentName:"ol"},"Next, we will setup a mock Stencil server to serve this proto descriptor set to Dagger. Open up a new tab in your terminal and ",(0,n.kt)("inlineCode",{parentName:"li"},"cd")," into this directory: ",(0,n.kt)("inlineCode",{parentName:"li"},"dagger-common/src/generated-sources/descriptors"),". Then fire this command:")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-python"},"python -m SimpleHTTPServer 8000\n")),(0,n.kt)("p",null,"This will spin up a mock HTTP server and serve the descriptor set we just generated in the previous step at port 8000.\nThe Stencil client being used in Dagger will fetch it by calling this URL. This has been already configured in ",(0,n.kt)("inlineCode",{parentName:"p"},"local.properties"),", as we have set ",(0,n.kt)("inlineCode",{parentName:"p"},"SCHEMA_REGISTRY_STENCIL_ENABLE")," to true and pointed ",(0,n.kt)("inlineCode",{parentName:"p"},"SCHEMA_REGISTRY_STENCIL_URLS")," to ",(0,n.kt)("inlineCode",{parentName:"p"},"http://127.0.0.1:8000/dagger-descriptors.bin"),"."),(0,n.kt)("ol",{start:4},(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Next, we will generate and send some messages to a sample kafka topic as per some proto schema. Note that, in ",(0,n.kt)("inlineCode",{parentName:"p"},"local.properties")," we have set ",(0,n.kt)("inlineCode",{parentName:"p"},"INPUT_SCHEMA_PROTO_CLASS")," under ",(0,n.kt)("inlineCode",{parentName:"p"},"STREAMS")," to use ",(0,n.kt)("inlineCode",{parentName:"p"},"io.odpf.dagger.consumer.TestPrimitiveMessage")," proto. Hence, we will push messages which conform to this schema into the topic. For doing this, please follow these steps:"),(0,n.kt)("ol",{parentName:"li"},(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("inlineCode",{parentName:"li"},"cd")," into the directory ",(0,n.kt)("inlineCode",{parentName:"li"},"dagger-common/src/test/proto"),". You should see a text file ",(0,n.kt)("inlineCode",{parentName:"li"},"sample_message.txt")," which contains just one message. We will encode it into a binary in protobuf format."),(0,n.kt)("li",{parentName:"ol"},"Fire this command:")),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-protobuf"},"protoc --proto_path=./ --encode=io.odpf.dagger.consumer.TestPrimitiveMessage ./TestLogMessage.proto < ./sample_message.txt > out.bin\n")),(0,n.kt)("p",{parentName:"li"},"This will generate a binary file called ",(0,n.kt)("inlineCode",{parentName:"p"},"out.bin"),". It contains the binary encoded message of ",(0,n.kt)("inlineCode",{parentName:"p"},"sample_message.txt"),"."),(0,n.kt)("ol",{parentName:"li",start:3},(0,n.kt)("li",{parentName:"ol"},"Next, we will push this encoded message to the source Kafka topic as mentioned under ",(0,n.kt)("inlineCode",{parentName:"li"},"SOURCE_KAFKA_TOPIC_NAMES")," inside ",(0,n.kt)("inlineCode",{parentName:"li"},"STREAMS")," inside ",(0,n.kt)("inlineCode",{parentName:"li"},"local.properties"),". Ensure Kafka is running at ",(0,n.kt)("inlineCode",{parentName:"li"},"localhost:9092")," and then, fire this command:")),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-shell"},'kcat -P -b localhost:9092 -D "\\n" -T -t dagger-test-topic-v1 out.bin\n')),(0,n.kt)("p",{parentName:"li"},"You can also fire this command multiple times, if you want multiple messages to be sent into the topic. Just make sure you increment the ",(0,n.kt)("inlineCode",{parentName:"p"},"event_timestamp")," value every time inside ",(0,n.kt)("inlineCode",{parentName:"p"},"sample_message.txt")," and then repeat the above steps. ")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("inlineCode",{parentName:"p"},"cd")," into the repository root again (",(0,n.kt)("inlineCode",{parentName:"p"},"dagger"),") and start Dagger by running the following command:"))),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"./gradlew dagger-core:runFlink\n")),(0,n.kt)("p",null,"After some initialization logs, you should see the output of the SQL query getting printed."),(0,n.kt)("h2",{id:"troubleshooting"},"Troubleshooting"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"I am pushing messages to the kafka topic but not seeing any output in the logs.")," "),(0,n.kt)("p",{parentName:"li"},"This can happen for the following reasons:"),(0,n.kt)("p",{parentName:"li"},"a. Pushed messages are not reaching the right topic: Check for any exceptions or errors when pushing messages to the Kafka topic. Ensure that the topic to which you are pushing messages is the same one for which you have configured Dagger to read from under ",(0,n.kt)("inlineCode",{parentName:"p"},"STREAMS")," -> ",(0,n.kt)("inlineCode",{parentName:"p"},"SOURCE_KAFKA_TOPIC_NAMES")," in ",(0,n.kt)("inlineCode",{parentName:"p"},"local.properties")),(0,n.kt)("p",{parentName:"li"},"b. The consumer group is not updated: Dagger might have already processed those messages. If you have made any changes to the setup, make sure you update the ",(0,n.kt)("inlineCode",{parentName:"p"},"STREAMS")," -> ",(0,n.kt)("inlineCode",{parentName:"p"},"SOURCE_KAFKA_CONSUMER_CONFIG_GROUP_ID")," variable in ",(0,n.kt)("inlineCode",{parentName:"p"},"local.properties")," to some new value.")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"I see an exception ",(0,n.kt)("inlineCode",{parentName:"strong"},"java.lang.RuntimeException: Unable to retrieve any partitions with KafkaTopicsDescriptor: Topic Regex Pattern"))),(0,n.kt)("p",{parentName:"li"},"This can happen if the topic configured under ",(0,n.kt)("inlineCode",{parentName:"p"},"STREAMS")," -> ",(0,n.kt)("inlineCode",{parentName:"p"},"SOURCE_KAFKA_TOPIC_NAMES")," in ",(0,n.kt)("inlineCode",{parentName:"p"},"local.properties")," is new and you have not pushed any messages to it yet. Ensure that you have pushed atleast one message to the topic before you start dagger."))))}c.isMDXComponent=!0}}]);